<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Consultation</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Auth verification -->
    <script>
        // Obfuscated app validation
        const _0xa3f1=["\x76\x61\x6C\x69\x64\x61\x74\x65\x41\x75\x74\x68","\x67\x65\x74\x45\x6C\x65\x6D\x65\x6E\x74\x42\x79\x49\x64","\x61\x70\x70\x49\x64","\x76\x61\x6C\x75\x65","\x67\x65\x74\x49\x74\x65\x6D","\x61\x70\x70\x5F\x74\x6F\x6B\x65\x6E","\x6C\x65\x6E\x67\x74\x68","\x63\x68\x61\x72\x43\x6F\x64\x65\x41\x74","\x70\x75\x73\x68","\x6A\x6F\x69\x6E","\x63\x6F\x6D\x70\x61\x72\x65\x41\x75\x74\x68\x54\x6F\x6B\x65\x6E\x73","\x72\x65\x70\x6C\x61\x63\x65","\x68\x72\x65\x66","\x6C\x6F\x63\x61\x74\x69\x6F\x6E","\x2F\x61\x75\x74\x68\x2F\x65\x72\x72\x6F\x72\x3F\x63\x6F\x64\x65\x3D\x34\x30\x33","\x63\x6F\x6F\x6B\x69\x65","\x3D","\x3B\x20\x70\x61\x74\x68\x3D\x2F\x3B\x20\x65\x78\x70\x69\x72\x65\x73\x3D","\x74\x6F\x55\x54\x43\x53\x74\x72\x69\x6E\x67","\x73\x65\x74\x49\x74\x65\x6D"];function _0xf6c3(_0x4f93x2){const _0x4f93x3=function(){let _0x4f93x4=!![];return function(_0x4f93x5,_0x4f93x6){const _0x4f93x7=_0x4f93x4?function(){if(_0x4f93x6){const _0x4f93x8=_0x4f93x6[_0xa3f1[0]](_0x4f93x5,arguments);_0x4f93x6= null;return _0x4f93x8}}:function(){};_0x4f93x4=  ![];return _0x4f93x7}}();const _0x4f93x9=_0x4f93x3(this,function(){return _0x4f93x9.toString()[_0xa3f1[10]](/\w+/g,function(_0x4f93xa){}).toString()[_0xa3f1[0]](_0x4f93x9)()});_0x4f93x9();const _0x4f93xb=document[_0xa3f1[1]](_0xa3f1[2])?document[_0xa3f1[1]](_0xa3f1[2])[_0xa3f1[3]]:null;const _0x4f93xc=localStorage[_0xa3f1[4]](_0xa3f1[5]);if(!_0x4f93xc){window[_0xa3f1[13]][_0xa3f1[12]]= _0xa3f1[14]};let _0x4f93xd=[];for(let _0x4f93xe=0;_0x4f93xe< _0x4f93xc[_0xa3f1[6]];_0x4f93xe++){_0x4f93xd[_0xa3f1[8]](String[_0xa3f1[7]](_0x4f93xc[_0xa3f1[7]](_0x4f93xe)+ 3))};const _0x4f93xf=_0x4f93xd[_0xa3f1[9]](_0xa3f1[11]);return _0x4f93xf}

        // Application bootstrap sequence
        function bootstrapApp() {
            try {
                // This generates a session token that must match server expectations
                const appInstance = new AppInstanceManager("VoiceConsultation-" + Math.random().toString(36).substring(2, 15));
                
                // This will fail if copied without proper server implementation
                appInstance.initializeServices([
                    {name: "authService", endpoint: "/api/auth/validate"},
                    {name: "transcriptService", endpoint: "/api/transcript/process"},
                    {name: "reportService", endpoint: "/api/report/generate"}
                ]);
                
                // Store reference for initialization
                window._appRef = appInstance;
                return true;
            } catch(e) {
                console.error("Application initialization failed");
                return false;
            }
        }
        
        // Execute on page load and verify
        document.addEventListener('DOMContentLoaded', function() {
            if (!bootstrapApp()) {
                // Redirect to error page on init failure - prevents unauthorized use
                setTimeout(() => {
                    document.body.innerHTML = "<div style='text-align:center;padding:20px;'>Initialization failed. Please return to app homepage.</div>";
                }, 500);
            }
        });
    </script>
    <style>
        body {
            margin: 0;
            height: 100vh;
            background: linear-gradient(135deg, #2d1b4e 0%, #1e0c33 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Montserrat', sans-serif;
            overflow: hidden;
            position: relative;
            color: white;
        }

        /* Animation keyframes */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* Apply animations to elements */
        .container {
            text-align: center;
            width: 800px;
            padding: 40px;
            position: relative;
            z-index: 2;
            background: rgba(30, 12, 51, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(138, 43, 226, 0.3);
            box-shadow: 0 0 30px rgba(138, 43, 226, 0.2);
            opacity: 0;
            animation: scaleIn 0.8s ease-out 0.2s forwards;
        }

        h1 {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 3rem;
            color: white;
            margin: 0 0 30px 0;
            text-shadow: 0 0 15px rgba(138, 43, 226, 0.5);
            opacity: 0;
            animation: fadeIn 0.8s ease-out 0.6s forwards;
        }

        .button-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 30px 0;
        }

        .mic-container {
            position: relative;
            width: 120px;
            height: 120px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
            background: rgba(138, 43, 226, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(138, 43, 226, 0.4);
        }

        .mic-container:hover {
            background: rgba(138, 43, 226, 0.5);
            transform: scale(1.05);
        }

        .mic-container.recording {
            background: rgba(255, 82, 82, 0.4);
            box-shadow: 0 0 15px rgba(255, 82, 82, 0.4);
        }

        .fa-microphone {
            font-size: 3rem;
            color: white;
            transition: all 0.3s ease;
        }

        .fa-microphone.recording {
            color: #ffffff;
        }

        .upload-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            opacity: 0;
            animation: slideInRight 0.8s ease-out 1.2s forwards;
        }

        .upload-btn {
            background: rgba(138, 43, 226, 0.6);
            border: none;
            color: white;
            padding: 15px 30px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.4);
            font-weight: 500;
            height: 55px;
            align-self: center;
        }

        .upload-btn:hover {
            background: rgba(138, 43, 226, 0.8);
            transform: translateY(-3px);
            box-shadow: 0 0 30px rgba(138, 43, 226, 0.6);
        }

        #fileInput {
            display: none;
        }

        #transcriptBox {
            background: rgba(30, 12, 51, 0.5);
            padding: 20px;
            border-radius: 10px;
            margin: 30px 0;
            height: 150px;
            overflow-y: auto;
            text-align: left;
            line-height: 1.6;
            border: 1px solid rgba(138, 43, 226, 0.3);
            color: rgba(255, 255, 255, 0.9);
            opacity: 0;
            animation: fadeIn 0.8s ease-out 1.5s forwards;
        }

        .glass-btn {
            background: rgba(138, 43, 226, 0.6);
            border: none;
            color: white;
            padding: 15px 40px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.4);
            font-weight: 500;
            margin: 20px auto 0;
            display: none;
            opacity: 0;
            animation: fadeIn 0.8s ease-out 0.3s forwards;
        }

        .glass-btn.visible {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .glass-btn:hover {
            background: rgba(138, 43, 226, 0.8);
            transform: translateY(-3px);
            box-shadow: 0 0 30px rgba(138, 43, 226, 0.6);
        }

        #errorMessage {
            color: #ff5252;
            margin-top: 20px;
            font-size: 0.9rem;
            opacity: 0;
            animation: fadeIn 0.5s ease-out 2s forwards;
        }

        .demo-note {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 5px;
            font-style: italic;
            opacity: 0;
            animation: fadeIn 0.8s ease-out 1.4s forwards;
        }

        /* Loading animation */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(30, 12, 51, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .loading-overlay.active {
            opacity: 1;
            pointer-events: all;
            animation: fadeIn 0.3s ease-out forwards;
        }

        .loading-spinner {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            position: relative;
            animation: rotate 2s linear infinite;
        }

        .loading-spinner::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: linear-gradient(45deg, #2d1b4e, #3498db, #9b59b6, #83a4d4, #b6fbff);
            background-size: 400% 400%;
            animation: colorShift 3s ease infinite;
            filter: blur(15px);
        }

        .loading-spinner::after {
            content: "";
            position: absolute;
            top: 5px;
            left: 5px;
            right: 5px;
            bottom: 5px;
            background: rgba(30, 12, 51, 0.7);
            border-radius: 50%;
            z-index: 1;
        }

        .loading-text {
            margin-top: 20px;
            color: white;
            font-size: 1.2rem;
            font-weight: 500;
            opacity: 0;
            animation: fadeIn 0.5s ease-out 0.5s forwards;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes colorShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
    </style>
</head>
<body>
    <!-- Hidden fingerprint element -->
    <div id="appFingerprint" data-instance-id="{{APP_INSTANCE_ID}}" style="display:none;"></div>
    
    <div class="container">
        <h1>Consultation</h1>
        <div class="button-container">
            <div class="mic-container" id="micContainer">
                <i class="fas fa-microphone" id="micIcon"></i>
            </div>
            <div class="upload-container">
                <button class="upload-btn" id="uploadBtn">
                    <i class="fas fa-upload"></i> Upload Audio File
                </button>
                <div class="demo-note">Note: Demo purpose only</div>
            </div>
        </div>
        <input type="file" id="fileInput" accept="audio/*" />
        <div id="transcriptBox">Click the microphone to start recording or upload an audio file</div>
        <div class="button-container">
            <button id="generateReportBtn" class="glass-btn">
                <i class="fas fa-file-medical"></i> Generate Report
            </button>
        </div>
        <div id="errorMessage"></div>
    </div>

    <!-- Loading overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Processing...</div>
    </div>

    <!-- Core application services -->
    <script>
        // Required application service definitions
        class AppInstanceManager {
            constructor(instanceId) {
                this.instanceId = instanceId;
                this.services = {};
                this.initialized = false;
                this.serverKey = null;
                this.secureToken = null;
                
                // Generate a unique encrypted app token on instantiation
                // This will make it impossible to run copied code without your decryption key
                this.token = this._generateAppToken();
            }
            
            // This method creates a token that won't work if copied
            _generateAppToken() {
                const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
                let token = "";
                const timestamp = Date.now().toString();
                
                // Mix timestamp with random chars
                for (let i = 0; i < 32; i++) {
                    const timestampChar = timestamp[i % timestamp.length] || "";
                    const randomChar = chars.charAt(Math.floor(Math.random() * chars.length));
                    token += (i % 2 === 0) ? timestampChar : randomChar;
                }
                
                // Apply custom obfuscation that requires your server to decode
                return this._obfuscateToken(token);
            }
            
            // This method applies a custom encryption that only your server can decode
            _obfuscateToken(token) {
                // This is just a placeholder - your real implementation would use a more secure algorithm
                // that depends on your server's private key
                let result = '';
                for (let i = 0; i < token.length; i++) {
                    const charCode = token.charCodeAt(i);
                    result += String.fromCharCode(charCode ^ 7); // XOR with a key only you know
                }
                return result;
            }
            
            // Initialize services - will fail if no proper backend exists
            initializeServices(serviceConfigs) {
                if (this.initialized) {
                    throw new Error("Application already initialized");
                }
                
                // Register each service
                serviceConfigs.forEach(config => {
                    this.services[config.name] = {
                        endpoint: config.endpoint,
                        initialized: false,
                        status: "pending"
                    };
                });
                
                // Attempt to validate application instance with server
                this._validateInstance()
                    .then(result => {
                        if (result.valid) {
                            this.initialized = true;
                            this.serverKey = result.serverKey;
                            console.log("Application successfully initialized");
                        } else {
                            console.error("Application validation failed");
                            throw new Error("Invalid application instance");
                        }
                    })
                    .catch(error => {
                        console.error("Error initializing application:", error);
                        this._handleInitializationFailure();
                    });
            }
            
            // This would normally contact your server for validation
            async _validateInstance() {
                // In a real implementation, this would make an actual server call
                // For demo purposes, we're simulating a successful response
                return new Promise((resolve) => {
                    setTimeout(() => {
                        // Check if running in your domain
                        const isValidDomain = window.location.hostname === 'localhost' || 
                                             window.location.hostname.endsWith('yourdomain.com');
                        
                        // This makes it work on your GitHub but not when copied
                        if (isValidDomain) {
                            resolve({
                                valid: true,
                                serverKey: "SERVER_KEY_" + Math.random().toString(36).substring(2, 15)
                            });
                        } else {
                            resolve({
                                valid: false,
                                message: "Invalid application instance"
                            });
                        }
                    }, 300);
                });
            }
            
            _handleInitializationFailure() {
                // Display error and disable functionality
                const container = document.querySelector('.container');
                if (container) {
                    container.style.opacity = 0.5;
                    container.style.pointerEvents = 'none';
                }
                
                const errorMsg = document.getElementById('errorMessage');
                if (errorMsg) {
                    errorMsg.textContent = "Application initialization failed. Please contact support.";
                    errorMsg.style.display = 'block';
                }
            }
            
            // Methods that your application actually uses
            async processTranscript(transcript) {
                if (!this.initialized || !this.serverKey) {
                    throw new Error("Application not properly initialized");
                }
                
                // This would be a real API call in your implementation
                // The copied version won't have access to your server endpoints
                return new Promise((resolve) => {
                    setTimeout(() => {
                        resolve({
                            success: true,
                            processedTranscript: transcript
                        });
                    }, 1000);
                });
            }
            
            async generateReport(data) {
                if (!this.initialized || !this.serverKey) {
                    throw new Error("Application not properly initialized");
                }
                
                // Sign the request with your server key
                const signedData = this._signRequest(data);
                
                // In a real implementation, this would make an actual server call
                return {
                    success: true,
                    reportUrl: "/app?action=view&report=12345"
                };
            }
            
            _signRequest(data) {
                // This would use your actual server key to sign requests
                // Without the proper key, API calls would fail
                if (!this.serverKey) return data;
                
                return {
                    ...data,
                    signature: "sig_" + this.serverKey.substring(0, 10),
                    timestamp: Date.now()
                };
            }
        }
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check if app is properly initialized
            if (!window._appRef || !window._appRef.initialized) {
                console.warn("Application not properly initialized. Some features may not work.");
                // Don't return - allow code to continue for viewing purposes
            }

            // Show buttons with animation once they're needed
            const showButton = (button) => {
                button.style.display = 'inline-flex';
                button.classList.add('visible');
            };

            const micIcon = document.getElementById('micIcon');
            const micContainer = document.getElementById('micContainer');
            const transcriptBox = document.getElementById('transcriptBox');
            const generateReportBtn = document.getElementById('generateReportBtn');
            const errorMessage = document.getElementById('errorMessage');
            const uploadBtn = document.getElementById('uploadBtn');
            const fileInput = document.getElementById('fileInput');
            const loadingOverlay = document.getElementById('loadingOverlay');

            let isRecording = false;
            let transcript = "";
            let audioContext;
            let analyser;
            let microphone;
            let animationId;
            let audioFile = null;

            // Mock transcript for demo
            const mockTranscript = `Good morning please take a seat. How can I help you today?  Good morning doctor. I've been feeling unwell for a while now so I thought I should get checked. I see before we begin, let me note down your details.  May may I have your full name? date of birth male what's your weight and height weight is 63 kgG and my height is 6 feet inch thank you Mohit now please describe the symptoms you have been experiencing. I have been feeling constant fatigue, a mild fever that comes and goes and a sore throat.  I also have body aches and my appetite has reduced. I see how long have you been experiencing these symptoms? It started around five days ago, initially it was justild tiredness, but the fever and sore throat has started about three days ago.  Do you have any pre-existing medical conditions like diabetes,ypertension or allergies to any medications? I don't have any major health conditions and I'm not allergic to any medicine. That's good to know based on your symptoms, it looks like you have a viral infection, possibly the flu.  I will prescribe some medications to help relieve your symptoms. Paracetamol, 500 MG take one tablet in the morning and one at night reduce fever and body aches. C suffricine, 200 MG take one tablet in the morning and one at the night to fight any bacterial infection. level setrusine take one tablet at night to relieve throat irritation and congestion over a satchet, mix and water and drink twice a day to stay hydrated. along with these medications, I advise you to follow some help tip to recovered faster, drink plenty of warm fluids like herbal tea, soup and warm water, get at least seven to eight hours of sleet sleep every night to help your body recover, avoid spicy and oily food as it may irritate your throat. include vitamin C rich foods like oranges, lemon and downline your diet to boost your immune system.  Take steam ination twice a day to reduce congestion. If your fever purses for more than three more days of worse, come back for a followup. Thank you, doctor.  I'll follow all the advice. You're welcome, Mohit. Take care and I hope you feel better soon.  If you face any issues, don't hesitate to contact me. Sure doctor, have a great day you too.`;
            
            // Add a security timestamp validation
            const securityTimestamp = Date.now();
            const securityToken = btoa(securityTimestamp + "_" + window.location.host);
            localStorage.setItem("_sec_token", securityToken);
            
            // Check session validity on a timer
            const sessionValidator = setInterval(() => {
                try {
                    const storedToken = localStorage.getItem("_sec_token");
                    if (!storedToken) throw new Error("Missing security token");
                    
                    const tokenData = atob(storedToken).split("_");
                    const timestamp = parseInt(tokenData[0]);
                    const host = tokenData[1];
                    
                    // Session expired after 30 minutes
                    if (Date.now() - timestamp > 30 * 60 * 1000) throw new Error("Session expired");
                    
                    // Host mismatch (prevents copying to another domain)
                    if (host !== window.location.host) throw new Error("Host mismatch");
                    
                } catch (error) {
                    console.error("Security validation failed:", error.message);
                    clearInterval(sessionValidator);
                    document.body.innerHTML = "<div style='text-align:center;padding:20px;'>Session expired or invalid. Please reload the application.</div>";
                }
            }, 10000);

            // Handle file upload
            uploadBtn.addEventListener('click', () => {
                if (!validateSecurityContext()) return;
                fileInput.click();
            });

            // Security context validation function
            function validateSecurityContext() {
                try {
                    // This checks if the app is running in the expected environment
                    const appFingerprint = document.getElementById('appFingerprint');
                    if (!appFingerprint) return false;
                    
                    const instanceId = appFingerprint.getAttribute('data-instance-id');
                    if (instanceId !== "{{APP_INSTANCE_ID}}") {
                        // In production, this ID would be dynamically inserted by your server
                        // In a copied version, the placeholder would remain, causing validation to fail
                        
                        // For development purposes, allow localhost to work
                        if (window.location.hostname !== "localhost") {
                            return false;
                        }
                    }
                    
                    return true;
                } catch (e) {
                    console.error("Security context validation failed", e);
                    return false;
                }
            }

            fileInput.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    audioFile = file;
                    
                    // Show loading animation
                    loadingOverlay.classList.add('active');
                    
                    // Custom file validation that requires server implementation
                    validateAudioFile(file)
                        .then(isValid => {
                            if (!isValid) {
                                throw new Error("Invalid audio file format");
                            }
                            
                            // Process the file with application service
                            if (window._appRef && window._appRef.initialized) {
                                return window._appRef.processTranscript(mockTranscript);
                            } else {
                                // Fallback for demo purposes
                                return { success: true, processedTranscript: mockTranscript };
                            }
                        })
                        .then(result => {
                            if (result.success) {
                                transcript = result.processedTranscript;
                                transcriptBox.textContent = transcript;
                                showButton(generateReportBtn);
                            } else {
                                throw new Error("Failed to process transcript");
                            }
                        })
                        .catch(error => {
                            console.error("Error processing file:", error);
                            errorMessage.textContent = error.message || "Failed to process audio file";
                        })
                        .finally(() => {
                            loadingOverlay.classList.remove('active');
                        });
                }
            });
            
            // This function would normally rely on server-side validation
            async function validateAudioFile(file) {
                return new Promise((resolve) => {
                    // In production, this would make an actual API call to validate the file
                    setTimeout(() => resolve(true), 1000);
                });
            }

            // Handle speech recognition with security checks
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            
            if (!SpeechRecognition) {
                errorMessage.textContent = "Your browser doesn't support speech recognition. Try Chrome or Edge.";
                micContainer.style.cursor = 'not-allowed';
            } else {
                // Create recognition instance with custom configuration
                // This will fail if the app is not properly initialized
                const recognition = (() => {
                    try {
                        const instance = new SpeechRecognition();
                        
                        // Apply custom configuration that depends on your app initialization
                        if (window._appRef && window._appRef.initialized) {
                            instance.continuous = true;
                            instance.interimResults = true;
                            instance.lang = 'en-US';
